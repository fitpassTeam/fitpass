<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <link
      rel="icon"
      href="https://static.toss.im/icons/png/4x/icon-toss-logo.png"
    />
    <link rel="stylesheet" type="text/css" href="./style.css" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FitPass 결제 실패</title>
  </head>

  <body>
    <div class="result wrapper">
      <div class="box_section">
        <h2 style="padding: 20px 0px 10px 0px; color: #ef4444;">
          <img
            width="25px"
            src="https://static.toss.im/3d-emojis/u1F6A8-apng.png"
          />
          💳 FitPass 포인트 충전 실패
        </h2>
        <p id="code"></p>
        <p id="message"></p>
        
        <div style="margin-top: 30px;">
          <button class="button" onclick="retryPayment()" style="margin-right: 10px;">
            다시 시도
          </button>
          <button class="button" onclick="goToMainPage()">
            메인으로
          </button>
        </div>
      </div>
    </div>
    
    <script>
      const urlParams = new URLSearchParams(window.location.search);

      const codeElement = document.getElementById("code");
      const messageElement = document.getElementById("message");

      const errorCode = urlParams.get("code");
      const errorMessage = urlParams.get("message");

      codeElement.textContent = errorCode ? "에러코드: " + errorCode : "";
      messageElement.textContent = errorMessage ? "실패 사유: " + decodeURIComponent(errorMessage) : "결제가 취소되었습니다.";

      // 실패 정보를 서버에 전송 (선택사항)
      if (urlParams.get("orderId")) {
        fetch(`/api/payments/fail?orderId=${urlParams.get("orderId")}&message=${errorMessage || "결제 취소"}`, {
          method: "POST"
        }).catch(error => {
          console.error("실패 정보 전송 실패:", error);
        });
      }

      function retryPayment() {
        window.location.href = "/payment.html";
      }

      function goToMainPage() {
        window.location.href = "/";
      }
    </script>
  </body>
</html>