<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <link
      rel="icon"
      href="https://static.toss.im/icons/png/4x/icon-toss-logo.png"
    />
    <link rel="stylesheet" type="text/css" href="./style.css" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FitPass ê²°ì œ ì‹¤íŒ¨</title>
  </head>

  <body>
    <div class="result wrapper">
      <div class="box_section">
        <h2 style="padding: 20px 0px 10px 0px; color: #ef4444;">
          <img
            width="25px"
            src="https://static.toss.im/3d-emojis/u1F6A8-apng.png"
          />
          ğŸ’³ FitPass í¬ì¸íŠ¸ ì¶©ì „ ì‹¤íŒ¨
        </h2>
        <p id="code"></p>
        <p id="message"></p>
        
        <div style="margin-top: 30px;">
          <button class="button" onclick="retryPayment()" style="margin-right: 10px;">
            ë‹¤ì‹œ ì‹œë„
          </button>
          <button class="button" onclick="goToMainPage()">
            ë©”ì¸ìœ¼ë¡œ
          </button>
        </div>
      </div>
    </div>
    
    <script>
      const urlParams = new URLSearchParams(window.location.search);

      const codeElement = document.getElementById("code");
      const messageElement = document.getElementById("message");

      const errorCode = urlParams.get("code");
      const errorMessage = urlParams.get("message");

      codeElement.textContent = errorCode ? "ì—ëŸ¬ì½”ë“œ: " + errorCode : "";
      messageElement.textContent = errorMessage ? "ì‹¤íŒ¨ ì‚¬ìœ : " + decodeURIComponent(errorMessage) : "ê²°ì œê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.";

      // ì‹¤íŒ¨ ì •ë³´ë¥¼ ì„œë²„ì— ì „ì†¡ (ì„ íƒì‚¬í•­)
      if (urlParams.get("orderId")) {
        fetch(`/api/payments/fail?orderId=${urlParams.get("orderId")}&message=${errorMessage || "ê²°ì œ ì·¨ì†Œ"}`, {
          method: "POST"
        }).catch(error => {
          console.error("ì‹¤íŒ¨ ì •ë³´ ì „ì†¡ ì‹¤íŒ¨:", error);
        });
      }

      function retryPayment() {
        window.location.href = "/payment.html";
      }

      function goToMainPage() {
        window.location.href = "/";
      }
    </script>
  </body>
</html>